{% extends "base.html" %}
{% block title %}Lobby â€” Chess Online Ultimate{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/lobby.css') }}"/>
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">

      <div class="d-flex justify-content-between align-items-center mb-5">
        <h1 class="h2 fw-bold">Game Lobby</h1>
      </div>

      <div class="row g-4">
        <!-- Create New Room -->
        <div class="col-md-6 col-lg-4">
          <div class="card h-100 text-center room-card border-primary">
            <div class="card-body d-flex flex-column justify-content-center py-5">
              <i class="fas fa-plus-circle fa-3x text-primary mb-3"></i>
              <h5 class="card-title">Create New Game</h5>
              <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#createRoomModal">
                Create Room
              </button>
            </div>
          </div>
        </div>

        <!-- Existing Rooms (will be populated by JS) -->
        <div id="room-list" class="col-12">
          <div class="text-center py-5 text-muted">
            <i class="fas fa-spinner fa-spin fa-2x"></i>
            <p class="mt-3">Loading available games...</p>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Create Room Modal -->
<div class="modal fade" id="createRoomModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Create New Game Room</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Room Name</label>
          <input type="text" id="roomNameInput" class="form-control" placeholder="e.g. Matthew's Arena" maxlength="30"/>
        </div>
        <div class="mb-3">
          <label class="form-label">Your Skill Level (ID)</label>
          <input type="number" id="skillInput" class="form-control" value="100" min="1" max="9999"/>
          <small class="text-muted">Used as your deck identifier</small>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-success" id="confirmCreateRoom">Create & Join</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
  const socket = io();

  document.getElementById('confirmCreateRoom').addEventListener('click', () => {
    const roomName = document.getElementById('roomNameInput').value.trim();
    const skill = document.getElementById('skillInput').value;

    if (!roomName) {
      alert("Please enter a room name!");
      return;
    }

    // Redirect to chess room
    window.location.href = `/chess/${encodeURIComponent(roomName)}?skill=${skill}`;
  });

  // Optional: Auto-join via Socket.IO if you want live room list
  socket.on('connect', () => {
    console.log("Connected to server");
    // You can emit 'request_rooms' here if you implement live lobby
  });
</script>
{% endblock %}